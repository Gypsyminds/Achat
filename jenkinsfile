pipeline {
    agent any



    stages{
        stage('Checkout Git'){
            steps{
                echo 'pulling';
                git branch :'master',
                url :'https://github.com/Gypsyminds/achat.git';
             
            }
        }

    stage ("Clean"){
        steps{
                sh "mvn clean"
            }
    }
    stage('Compile'){
            steps {
                sh 'mvn compile -DskipTests'  
            }
        }
    stage ("Package"){
        steps{
                sh "mvn package -DskipTests"
            }
        }

    stage ("test"){
        steps{
                sh "mvn test"
            }
        }
  stage('SonarQube Analysis'){
            steps {
    withSonarQubeEnv(credentialsId:'test1',installationName:'sonarqube') {
                    sh """
                        mvn sonar:sonar \
                        -D sonar.login=admin \
                        -D sonar.password=sonar \
                    """
                }
               }
               }
           stage ("Nexus"){
			steps{
			nexusArtifactUploader artifacts: [[artifactId: 'achat', 
            file: 'target/achat-1.0.jar', type: 'jar']],
            credentialsId: 'nexus', groupId: 'tn.esprit.rh', 
            nexusUrl: 'http://192.168.1.101:8081', 
            nexusVersion: 'nexus3', protocol: 'http', 
            repository: 'achat', version: '1.0'
			}
		}
    
                
        }
}
